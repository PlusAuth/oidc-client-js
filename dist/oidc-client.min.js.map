{"version":3,"file":"oidc-client.min.js","sources":["../src/constants/events.ts","../src/errors.ts","../src/helpers/state_manager/state_store.ts","../src/helpers/state_manager/local_storage.ts","../src/helpers/state_manager/in_memory.ts","../src/helpers/event_emitter.ts","../src/helpers/timer.ts","../src/utils/iframe.ts","../src/client.ts","../node_modules/.pnpm/base64-js@1.5.1/node_modules/base64-js/index.js","../src/utils/url.ts","../src/utils/request.ts","../src/utils/crypto.ts","../src/utils/jose.ts","../src/utils/object.ts","../src/utils/oidc.ts","../src/utils/popup.ts","../src/utils/tab_utils.ts","../src/utils/check_session_iframe.ts","../src/index.ts"],"sourcesContent":["/* eslint-disable @typescript-eslint/indent */\nexport const Events = {\n  USER_LOGOUT: \"user_logout\",\n  USER_LOGIN: \"user_login\",\n  SILENT_RENEW_SUCCESS: \"silent_renew_success\",\n  SILENT_RENEW_ERROR: \"silent_renew_error\",\n  SESSION_CHANGE: \"session_change\",\n} as const\n\nexport type EventTypes =\n  | \"user_logout\"\n  | \"user_login\"\n  | \"silent_renew_success\"\n  | \"silent_renew_error\"\n  | \"session_change\"\n  | \"session_error\"\n","export class OIDCClientError extends Error {\n  error: string\n\n  error_description?: string\n\n  public constructor(error: string, error_description?: string) {\n    super(`${error}${(error_description && ` - ${error_description}`) || \"\"}`)\n    this.name = \"OIDCClientError\"\n    this.error = error\n    this.error_description = error_description\n  }\n}\n\nexport class AuthenticationError extends OIDCClientError {\n  state?: string\n\n  error_uri?: string\n\n  constructor(error: string, error_description?: string, state?: string, error_uri?: string) {\n    super(error, error_description)\n    this.name = \"AuthenticationError\"\n    this.state = state\n    this.error_uri = error_uri\n  }\n}\n\nexport class StateNotFound extends AuthenticationError {\n  state?: string\n\n  constructor(error: string, state?: string) {\n    super(error)\n    this.name = \"StateNotFound\"\n    this.state = state\n  }\n}\n\nexport class InvalidJWTError extends OIDCClientError {\n  constructor(details: string) {\n    super(details)\n    this.name = \"InvalidJWTError\"\n    this.error_description = details\n  }\n}\n\nexport class InvalidIdTokenError extends InvalidJWTError {\n  constructor(details: string) {\n    super(details)\n    this.name = \"InvalidIdTokenError\"\n  }\n}\n\nexport class InteractionCancelled extends OIDCClientError {\n  constructor(details: string) {\n    super(details)\n    this.name = \"InteractionCancelled\"\n  }\n}\n","export interface StateStore<T = Record<string, any>> {\n  init?(): Promise<StateStore<T>>\n}\n// biome-ignore  lint/suspicious/noUnsafeDeclarationMerging:\nexport abstract class StateStore<T = Record<string, any>> {\n  prefix: string\n\n  constructor(prefix = \"\") {\n    this.prefix = prefix\n  }\n\n  public abstract get(key: string): Promise<T | null>\n\n  public abstract set(key: string, value: T): Promise<void>\n\n  public abstract del(key: string): Promise<void>\n\n  public abstract clear(maxAge?: number): Promise<void>\n}\n","import { StateStore } from \"./state_store\"\n\nexport class LocalStorageStateStore<T = any> extends StateStore<T> {\n  constructor(prefix = \"pa_oidc.\") {\n    super(prefix)\n  }\n\n  get(key: string) {\n    return new Promise<T | null>((resolve) => {\n      const value = window.localStorage.getItem(this.prefix + key)\n      if (value) {\n        resolve(JSON.parse(value))\n      } else {\n        resolve(null)\n      }\n    })\n  }\n\n  set(key: string, value: T) {\n    return new Promise<void>((resolve) => {\n      window.localStorage.setItem(this.prefix + key, JSON.stringify(value))\n      resolve()\n    })\n  }\n\n  del(key: string) {\n    return new Promise<void>((resolve) => {\n      window.localStorage.removeItem(this.prefix + key)\n      resolve()\n    })\n  }\n\n  clear(before?: number): Promise<void> {\n    return new Promise<void>((resolve) => {\n      let i\n      const storedKeys: string[] = []\n      for (i = 0; i < window.localStorage.length; i++) {\n        const key = window.localStorage.key(i)\n        // items only created by oidc client\n        if (key?.substring(0, this.prefix.length) === this.prefix) {\n          storedKeys.push(key)\n        }\n      }\n      for (i = 0; i < storedKeys.length; i++) {\n        if (before) {\n          try {\n            const storedItem = JSON.parse(window.localStorage.getItem(storedKeys[i])!)\n            if (storedItem.created_at < before) {\n              window.localStorage.removeItem(storedKeys[i])\n            }\n          } catch (e) {}\n        } else {\n          window.localStorage.removeItem(storedKeys[i])\n        }\n      }\n      resolve()\n    })\n  }\n}\n","import { StateStore } from \"./state_store\"\n\nexport class InMemoryStateStore<T = any> extends StateStore<T> {\n  map = new Map()\n\n  clear(before?: number) {\n    if (before) {\n      this.map.forEach((val, ind) => {\n        if (val.created_at < before) {\n          this.map.delete(ind)\n        }\n      })\n      return Promise.resolve()\n    }\n    return Promise.resolve(this.map.clear())\n  }\n\n  del(key: string) {\n    this.map.delete(key)\n    return Promise.resolve()\n  }\n\n  get(key: string) {\n    return Promise.resolve(this.map.get(key) || null)\n  }\n\n  set(key: string, value: any) {\n    this.map.set(key, value)\n    return Promise.resolve()\n  }\n}\n","export type Listener = (...args: any) => void\n\nexport class EventEmitter<T extends string> {\n  callbacks: Record<string, any[]>\n\n  constructor() {\n    this.callbacks = {}\n  }\n\n  once(event: T, fn: (...args: any[]) => void) {\n    function on(this: EventEmitter<any>, ...onArgs: any[]) {\n      this.off(event, on)\n      fn.apply(this, onArgs)\n    }\n    on.fn = fn\n    this.on(event, on)\n    return this\n  }\n\n  on(event: T, cb: (...args: any[]) => void) {\n    if (!this.callbacks[`$${event}`]) this.callbacks[`$${event}`] = []\n    this.callbacks[`$${event}`].push(cb)\n    return this\n  }\n\n  off(event?: T, fn?: (...args: any[]) => void) {\n    if (!event) {\n      this.callbacks = {}\n      return this\n    }\n\n    // specific event\n    const callbacks = this.callbacks[`$${event}`]\n    if (!callbacks) return this\n\n    // remove all handlers\n    if (!fn) {\n      delete this.callbacks[`$${event}`]\n      return this\n    }\n\n    for (let i = 0; i < callbacks.length; i++) {\n      const cb = callbacks[i]\n      if (cb === fn || cb.fn === fn) {\n        callbacks.splice(i, 1)\n        break\n      }\n    }\n\n    // Remove event specific arrays for event types that no\n    // one is subscribed for to avoid memory leak.\n    if (callbacks.length === 0) {\n      delete this.callbacks[`$${event}`]\n    }\n\n    return this\n  }\n\n  emit(event: T, ...args: any[]) {\n    let cbs = this.callbacks[`$${event}`]\n    if (cbs) {\n      cbs = cbs.slice(0)\n      for (let i = 0, len = cbs.length; i < len; ++i) {\n        cbs[i].apply(this, args)\n      }\n    }\n    return this\n  }\n}\n","export class Timer {\n  private now: () => number\n\n  private _timerHandle: any\n\n  private _expiration!: number\n\n  constructor(currentTimeInMillisFunc = () => Date.now()) {\n    this.now = currentTimeInMillisFunc\n  }\n\n  start(duration: number, callback: () => void) {\n    if (duration <= 0) {\n      duration = 1\n    }\n    const expiration = this.now() / 1000 + duration\n    if (this._expiration === expiration && this._timerHandle) {\n      return\n    }\n\n    this.stop()\n\n    this._expiration = expiration\n\n    // prevent device sleep and delayed timers\n    let timerDuration = 5\n    if (duration < timerDuration) {\n      timerDuration = duration\n    }\n    this._timerHandle = setInterval(() => {\n      if (this._expiration <= this.now() / 1000) {\n        this.stop()\n        callback()\n      }\n    }, timerDuration * 1000)\n  }\n\n  stop() {\n    if (this._timerHandle) {\n      clearInterval(this._timerHandle)\n      this._timerHandle = null\n    }\n  }\n}\n","import { AuthenticationError, OIDCClientError } from \"../errors\"\nimport type { IFrameOptions } from \"../interfaces\"\n\nexport function createHiddenFrame() {\n  const iframe = window.document.createElement(\"iframe\")\n  iframe.style.width = \"0\"\n  iframe.style.height = \"0\"\n  iframe.style.position = \"absolute\"\n  iframe.style.visibility = \"hidden\"\n  iframe.style.display = \"none\"\n\n  iframe.title = \"__pa_helper__hidden\"\n  iframe.ariaHidden = \"true\"\n\n  return iframe\n}\n\nexport function runIframe(url: string, options: IFrameOptions) {\n  return new Promise<any>((resolve, reject) => {\n    let onLoadTimeoutId: any = null\n    const iframe = createHiddenFrame()\n\n    const timeoutSetTimeoutId = setTimeout(\n      () => {\n        reject(new OIDCClientError(\"Timed out\"))\n        removeIframe()\n      },\n      (options.timeout || 10) * 1000,\n    )\n\n    const iframeEventHandler = (e: MessageEvent) => {\n      if (e.origin !== options.eventOrigin) return\n      if (!e.data || e.data.type !== \"authorization_response\") return\n      const eventSource = e.source\n      if (eventSource) {\n        ;(<any>eventSource).close()\n      }\n\n      const resp = e.data.response || e.data\n      resp.error\n        ? reject(\n            new AuthenticationError(resp.error, resp.error_description, resp.state, resp.error_uri),\n          )\n        : resolve(e.data)\n      clearTimeout(timeoutSetTimeoutId)\n      removeIframe()\n    }\n\n    const removeIframe = () => {\n      if (onLoadTimeoutId != null) {\n        clearTimeout(onLoadTimeoutId)\n      }\n      if (window.document.body.contains(iframe)) {\n        window.document.body.removeChild(iframe)\n      }\n      window.removeEventListener(\"message\", iframeEventHandler, false)\n    }\n\n    const onLoadTimeout = () =>\n      setTimeout(() => {\n        reject(new OIDCClientError(\"Could not complete silent authentication\", url))\n        removeIframe()\n      }, 300)\n\n    window.addEventListener(\"message\", iframeEventHandler, false)\n    window.document.body.appendChild(iframe)\n    iframe.setAttribute(\"src\", url)\n\n    /**\n     * In case of wrong client id, wrong redirect_uri, in short when redirect did not happen\n     * we assume flow failed.\n     */\n    iframe.onload = () => {\n      onLoadTimeoutId = onLoadTimeout()\n    }\n  })\n}\n","import type { EventTypes } from \"./constants\"\nimport { Events } from \"./constants\"\n\nimport { AuthenticationError, InvalidIdTokenError, OIDCClientError, StateNotFound } from \"./errors\"\n\nimport type { StateStore } from \"./helpers\"\nimport { EventEmitter, InMemoryStateStore, LocalStorageStateStore } from \"./helpers\"\n\nimport { Timer } from \"./helpers/timer\"\nimport type {\n  AuthRecord,\n  AuthRequestOptions,\n  IEndpointConfiguration,\n  IPlusAuthClientOptions,\n  LogoutRequestOptions,\n  PopupOptions,\n  RevokeOptions,\n  SessionChecker,\n  SessionMonitorOptions,\n  StateRecord,\n  TokenRequestOption,\n  TokenResponse,\n  TokenType,\n} from \"./interfaces\"\n\nimport type { RequestOptions } from \"./utils\"\nimport {\n  buildEncodedQueryString,\n  createSessionCheckerFrame,\n  deriveChallenge,\n  generateRandom,\n  isValidIssuer,\n  nonUserClaims,\n  parseQueryUrl,\n  request,\n  runIframe,\n  validateIdToken,\n} from \"./utils\"\nimport { cleanUndefined, mergeObjects } from \"./utils/object\"\n\nimport { isResponseType, isScopeIncluded } from \"./utils/oidc\"\nimport { runPopup } from \"./utils/popup\"\nimport { TabUtils } from \"./utils/tab_utils\"\n\n/**\n * `OIDCClient` provides methods for interacting with OIDC/OAuth2 authorization server. Those methods are signing a\n * user in, signing out, managing the user's claims, checking session and managing tokens returned from the\n * OIDC/OAuth2 provider.\n *\n */\nexport class OIDCClient extends EventEmitter<EventTypes> {\n  options: IPlusAuthClientOptions\n\n  user?: any\n\n  scopes?: string[]\n\n  accessToken?: string\n\n  refreshToken?: string\n\n  idToken?: string\n\n  idTokenRaw?: string\n\n  issuer_metadata?: Record<string, any>\n\n  private readonly http: (options: RequestOptions) => Promise<any> | never\n\n  private synchronizer: TabUtils\n\n  private stateStore: StateStore<StateRecord>\n\n  private authStore: StateStore<AuthRecord>\n\n  private sessionCheckerFrame?: SessionChecker\n\n  private _accessTokenExpireTimer?: Timer\n\n  private initialized!: boolean\n\n  private __initializePromise!: Promise<any> | undefined\n\n  constructor(options: IPlusAuthClientOptions) {\n    super()\n    if (!isValidIssuer(options.issuer)) {\n      throw new OIDCClientError('\"issuer\" must be a valid uri.')\n    }\n\n    this.synchronizer = new TabUtils(btoa(options.issuer), this)\n\n    this.options = mergeObjects(\n      {\n        secondsToRefreshAccessTokenBeforeExp: 60,\n        autoSilentRenew: true,\n        checkSession: true,\n        stateLength: 10,\n        nonceLength: 10,\n      },\n      options,\n      {\n        // remove last slash for consistency across the lib\n        issuer: options.issuer.endsWith(\"/\") ? options.issuer.slice(0, -1) : options.issuer,\n      },\n    )\n\n    this.http = this.options.httpClient || request\n    this.stateStore =\n      this.options.stateStore || new LocalStorageStateStore<StateRecord>(\"pa_oidc.state.\")\n    this.authStore = this.options.authStore || new InMemoryStateStore<AuthRecord>()\n\n    if (this.options.autoSilentRenew) {\n      this._accessTokenExpireTimer = new Timer()\n    }\n\n    this.on(Events.USER_LOGOUT, async () => {\n      this.user = undefined\n      this.scopes = undefined\n      this.accessToken = undefined\n      this.idToken = undefined\n      this.refreshToken = undefined\n      await this.authStore.clear()\n    })\n\n    this.synchronizer.OnBroadcastMessage(Events.USER_LOGIN, this.onUserLogin.bind(this))\n  }\n\n  /**\n   * Initialize the library with this method. It resolves issuer configuration, jwks keys which are necessary for\n   * validating tokens returned from provider and checking if a user is already authenticated in provider.\n   *\n   * @param checkLogin Make this `false` if you don't want to check user authorization status in provider while\n   * initializing. Defaults to `true`\n   */\n  async initialize(checkLogin = true): Promise<OIDCClient> | never {\n    if (this.initialized) {\n      return this\n    }\n\n    if (this.__initializePromise) {\n      return this.__initializePromise\n    }\n    this.__initializePromise = new Promise(async (resolve, reject) => {\n      try {\n        if (this.stateStore.init) {\n          await this.stateStore.init()\n        }\n        if (this.authStore.init) {\n          await this.authStore.init()\n        }\n\n        if (!this.options.endpoints || Object.keys(this.options.endpoints).length === 0) {\n          await this.fetchFromIssuer()\n        }\n        this.initialized = true\n\n        if (checkLogin) {\n          try {\n            if (!window?.frameElement) {\n              await this.silentLogin()\n            }\n          } catch (e) {\n            this.emit(Events.SILENT_RENEW_ERROR, e)\n            await this.authStore.clear()\n          }\n        } else {\n          const localAuth = await this.authStore.get(\"auth\")\n          if (localAuth) {\n            await this.onUserLogin(localAuth, true)\n          }\n        }\n        resolve(this)\n      } catch (e) {\n        if (e instanceof OIDCClientError) {\n          reject(e)\n        } else {\n          reject(new OIDCClientError(e.message))\n        }\n      } finally {\n        this.__initializePromise = undefined\n      }\n    })\n\n    return this.__initializePromise\n  }\n\n  /**\n   * Redirect to provider's authorization endpoint using provided parameters. You can override any parameter defined\n   * in `OIDCClient`. If you don't provide `state`, `nonce` or `code_verifier` they will be generated automatically\n   * in a random and secure way.\n   *\n   * @param options\n   * @param localState\n   */\n  async login(options: Partial<AuthRequestOptions> = {}, localState: Record<string, any> = {}) {\n    window.location.assign(await this.createAuthRequest(options, localState))\n  }\n\n  /**\n   * Open a popup with the provider's authorization endpoint using provided parameters. You can override any\n   * parameter defined in `OIDCClient`. If you don't provide `state`, `nonce` or `code_verifier` they will be\n   * generated automatically in a random and secure way. You can also override popup options.\n   *\n   * NOTE: Most browsers block popups if they are not happened as a result of user actions. In order to display\n   * login popup you must call this method in an event handler listening for a user action like button click.\n   *\n   * @param options\n   * @param popupOptions\n   */\n  async loginWithPopup(options: Partial<AuthRequestOptions> = {}, popupOptions: PopupOptions = {}) {\n    const url = await this.createAuthRequest({\n      response_mode: \"fragment\",\n      ...options,\n      display: \"popup\",\n      request_type: \"p\",\n    })\n    const { response, state } = await runPopup(url, popupOptions)\n    const { authParams, localState } =\n      !state || typeof state === \"string\" ? await this.loadState(state || response.state) : state\n    const tokenResult = await this.handleAuthResponse(response, authParams, localState)\n    const authObject = await this.handleTokenResult(\n      tokenResult,\n      authParams,\n      mergeObjects(this.options, authParams),\n    )\n    authObject.session_state = response.session_state\n    this.synchronizer.BroadcastMessageToAllTabs(Events.USER_LOGIN, authObject)\n    return localState\n  }\n\n  /**\n   * After a user successfully authorizes an application, the authorization server will redirect the user back to\n   * the application with either an authorization code or access token in the URL. In the callback page you should\n   * call this method.\n   *\n   * @param url Full url which contains authorization request result parameters. Defaults to `window.location.href`\n   */\n  async loginCallback(url: string = window?.location?.href) {\n    if (!url) {\n      return Promise.reject(new OIDCClientError(\"Url must be passed to handle login redirect\"))\n    }\n    let parsedUrl: URL\n    try {\n      parsedUrl = new URL(url)\n    } catch (e) {\n      return Promise.reject(new OIDCClientError(`Invalid callback url passed: \"${url}\"`))\n    }\n\n    const responseParams = parseQueryUrl(parsedUrl.search || parsedUrl.hash)\n    const rawStoredState = await this.loadState(responseParams.state)\n    const { authParams, localState, request_type } = rawStoredState\n    url = url || window.location.href\n    switch (request_type) {\n      case \"s\":\n        if (window?.frameElement) {\n          if (url) {\n            window.parent.postMessage(\n              {\n                type: \"authorization_response\",\n                response: responseParams,\n                state: rawStoredState,\n              },\n              `${location.protocol}//${location.host}`,\n            )\n          }\n        }\n        return\n      case \"p\":\n        if (window.opener && url) {\n          window.opener.postMessage(\n            {\n              type: \"authorization_response\",\n              response: responseParams,\n              state: rawStoredState,\n            },\n            `${location.protocol}//${location.host}`,\n          )\n        }\n        return\n      default: {\n        if (responseParams.error) {\n          return Promise.reject(\n            new AuthenticationError(responseParams.error, responseParams.error_description),\n          )\n        }\n        const tokenResult = await this.handleAuthResponse(responseParams, authParams, localState)\n        const authObject = await this.handleTokenResult(\n          tokenResult,\n          authParams,\n          mergeObjects(this.options, authParams),\n        )\n        authObject.session_state = responseParams.session_state\n        this.synchronizer.BroadcastMessageToAllTabs(Events.USER_LOGIN, authObject)\n        return localState\n      }\n    }\n  }\n\n  /**\n   * Redirect to provider's `end_session_endpoint` with provided parameters. After logout provider will redirect to\n   * provided `post_logout_redirect_uri` if it provided.\n   * @param options\n   */\n  async logout(options: LogoutRequestOptions = {}) {\n    if (!options.localOnly) {\n      const storedAuth = await this.authStore.get(\"auth\")\n      const id_token_hint = options.id_token_hint || storedAuth?.id_token_raw\n      window.location.assign(\n        await this.createLogoutRequest({\n          ...options,\n          id_token_hint,\n        }),\n      )\n    }\n    await this.authStore.clear()\n  }\n\n  /**\n   * OAuth2 token revocation implementation method. See more at [tools.ietf.org/html/rfc7009](https://tools.ietf.org/html/rfc7009)\n   * @param token Token to be revoked\n   * @param type Passed token's type. It will be used to provide `token_type_hint` parameter.\n   * @param options If necessary override options passed to `OIDCClient` by defining them here.\n   */\n  async revokeToken(token: string, type: TokenType = \"access_token\", options: RevokeOptions = {}) {\n    if (!this.options.endpoints!.revocation_endpoint) {\n      return Promise.reject(new OIDCClientError('\"revocation_endpoint\" doesn\\'t exist'))\n    }\n    const finalOptions = {\n      client_id: options.client_id || this.options.client_id,\n      client_secret: options.client_secret || this.options.client_secret,\n      token_type_hint: type,\n      token: token,\n    }\n\n    return this.http({\n      method: \"POST\",\n      requestType: \"form\",\n      url: this.options.endpoints!.revocation_endpoint,\n      body: finalOptions,\n    })\n  }\n\n  /**\n   * Login without having an interaction. If refresh tokens are used and there is a stored refresh token it will\n   * exchange refresh token to receive new access token. If not it silently makes a request the provider's\n   * authorization endpoint using provided parameters. You can override any parameter defined in `OIDCClient`. If\n   * you don't provide `state`, `nonce` or `code_verifier` they will be generated automatically in a random and\n   * secure way.\n   *\n   * @param options\n   * @param localState\n   */\n  async silentLogin(options: AuthRequestOptions = {}, localState: Record<string, any> = {}) {\n    await this.initialize(false)\n    let tokenResult: any\n    let finalState: any = {}\n\n    const storedAuth = (await this.authStore.get(\"auth\")) || {}\n\n    const finalOptions = mergeObjects(\n      {\n        response_mode: \"query\",\n        display: \"page\",\n        prompt: \"none\",\n      },\n      this.options,\n      options,\n    )\n\n    if (finalOptions.silent_redirect_uri) {\n      finalOptions.redirect_uri = finalOptions.silent_redirect_uri\n    }\n\n    if (this.options.useRefreshToken && storedAuth?.refresh_token) {\n      finalState.authParams = mergeObjects(\n        storedAuth?.authParams || {},\n        finalState.authParams || {},\n      )\n      tokenResult = await this.exchangeRefreshToken({\n        ...finalOptions,\n        refresh_token: storedAuth.refresh_token,\n      })\n    } else {\n      const authUrl = await this.createAuthRequest(\n        {\n          ...finalOptions,\n          request_type: \"s\",\n        },\n        localState,\n      )\n\n      const { response, state } = await runIframe(authUrl, {\n        timeout: finalOptions.silentRequestTimeout,\n        eventOrigin: window.location.origin,\n      })\n      tokenResult = await this.handleAuthResponse(response, finalOptions, localState)\n      storedAuth.session_state = response.session_state\n      finalState = state\n    }\n\n    const authObject = await this.handleTokenResult(\n      tokenResult,\n      finalState.authParams,\n      finalOptions,\n    )\n    authObject.session_state = storedAuth.session_state\n    this.synchronizer.BroadcastMessageToAllTabs(Events.USER_LOGIN, authObject)\n    return finalState.localState\n  }\n\n  /**\n   * Retrieve logged in user's access token if it exists.\n   */\n  async getAccessToken() {\n    return (await this.authStore.get(\"auth\"))?.access_token\n  }\n\n  /**\n   * Retrieve logged in user's refresh token if it exists.\n   */\n  async getRefreshToken() {\n    return (await this.authStore.get(\"auth\"))?.refresh_token\n  }\n\n  /**\n   * Retrieve logged in user's parsed id token if it exists.\n   */\n  async getIdToken() {\n    return (await this.authStore.get(\"auth\"))?.id_token\n  }\n\n  /**\n   * Retrieve access token's expiration.\n   */\n  async getExpiresIn() {\n    return (await this.authStore.get(\"auth\"))?.expires_in\n  }\n\n  /**\n   * Retrieve logged in user's id token in raw format if it exists.\n   */\n  async getIdTokenRaw() {\n    return (await this.authStore.get(\"auth\"))?.id_token_raw\n  }\n\n  /**\n   * Retrieve logged in user's scopes if it exists.\n   */\n  async getScopes() {\n    return (await this.authStore.get(\"auth\"))?.scope?.split(\" \").filter(Boolean)\n  }\n\n  /**\n   * Retrieve logged in user's profile.\n   */\n  async getUser() {\n    return (await this.authStore.get(\"auth\"))?.user\n  }\n\n  /**\n   * If there is a user stored locally return true. Otherwise it will make a silentLogin to check if End-User is\n   * logged in provider.\n   *\n   * @param localOnly Don't check provider\n   */\n  async isLoggedIn(localOnly = false) {\n    const existsOnLocal = !!(await this.getUser())\n    if (!existsOnLocal && !localOnly) {\n      try {\n        await this.silentLogin()\n        return true\n      } catch (e) {\n        return false\n      }\n    }\n    return existsOnLocal\n  }\n\n  /**\n   * Create authorization request with provided options.\n   *\n   * @param options\n   * @param localState\n   * @private\n   */\n  private async createAuthRequest(\n    options: Partial<AuthRequestOptions> = {},\n    localState: Record<string, any> = {},\n  ): Promise<string> {\n    if (!this.options.endpoints?.authorization_endpoint) {\n      await this.initialize(false)\n    }\n    // TODO: deep merge for extra params\n    const finalOptions = Object.assign({}, this.options, options)\n    localState.code_verifier = generateRandom(72)\n\n    const authParams = {\n      client_id: finalOptions.client_id,\n      state: finalOptions.state || generateRandom(finalOptions.stateLength!),\n      scope: finalOptions.scope,\n      audience: finalOptions.audience,\n      redirect_uri: finalOptions.redirect_uri,\n      response_mode: finalOptions.response_mode,\n      response_type: finalOptions.response_type || \"code\",\n      ui_locales: finalOptions.ui_locales,\n      prompt: finalOptions.prompt,\n      display: finalOptions.display,\n      claims: finalOptions.claims,\n      claims_locales: finalOptions.claims_locales,\n      acr_values: finalOptions.acr_values,\n      nonce: finalOptions.nonce,\n      registration: finalOptions.registration,\n      login_hint: finalOptions.login_hint,\n      id_token_hint: finalOptions.id_token_hint,\n      web_message_uri: finalOptions.web_message_uri,\n      web_message_target: finalOptions.web_message_target,\n      ...(finalOptions.extraParams && finalOptions.extraParams),\n    } as AuthRequestOptions\n\n    if (\n      !authParams.nonce &&\n      (isResponseType(\"id_token\", authParams.response_type) ||\n        isScopeIncluded(\"openid\", authParams.scope))\n    ) {\n      authParams.nonce = generateRandom(finalOptions.nonceLength!)\n    }\n\n    if (isResponseType(\"code\", authParams.response_type)) {\n      authParams.code_challenge = await deriveChallenge(localState.code_verifier)\n      authParams.code_challenge_method = finalOptions.code_challenge_method || \"S256\"\n    }\n\n    const now = this.options.currentTimeInMillis?.() || Date.now()\n    const fragment = finalOptions.fragment ? `#${finalOptions.fragment}` : \"\"\n    const authParamsString = buildEncodedQueryString(authParams)\n    const url = `${this.options.endpoints!.authorization_endpoint}${authParamsString}${fragment}`\n\n    // clear 1 day old state entries\n    this.stateStore.clear(now - 86400000)\n\n    await this.stateStore.set(\n      authParams.state!,\n      cleanUndefined({\n        created_at: now,\n        authParams,\n        localState,\n        request_type: finalOptions.request_type,\n      }),\n    )\n    return url\n  }\n\n  /**\n   * Create a logout request with given options\n   *\n   * @param options\n   * @private\n   */\n  private async createLogoutRequest(options: LogoutRequestOptions = {}) {\n    if (!this.options.endpoints?.end_session_endpoint) {\n      await this.fetchFromIssuer()\n    }\n    const finalOptions = mergeObjects(this.options, options)\n    const logoutParams = {\n      id_token_hint: finalOptions.id_token_hint,\n      post_logout_redirect_uri: finalOptions.post_logout_redirect_uri,\n      ...(finalOptions.extraLogoutParams || {}),\n    }\n    return `${this.options.endpoints!.end_session_endpoint}${buildEncodedQueryString(logoutParams)}`\n  }\n\n  /**\n   * Exchange authorization code retrieved from auth request result.\n   * @param options\n   * @private\n   */\n  private async exchangeAuthorizationCode(options: TokenRequestOption) {\n    if (!this.options.endpoints?.token_endpoint) {\n      await this.fetchFromIssuer()\n    }\n    const finalOptions = mergeObjects(this.options, options)\n    const { extraTokenHeaders, extraTokenParams, ...rest } = finalOptions\n    const mergedOptions = {\n      ...rest,\n      ...(extraTokenParams || {}),\n      grant_type: \"authorization_code\",\n    }\n\n    for (const req of [\"code\", \"redirect_uri\", \"code_verifier\", \"client_id\"] as const) {\n      if (!mergedOptions[req]) {\n        return Promise.reject(new Error(`\"${req}\" is required`))\n      }\n    }\n\n    return this.http({\n      url: `${this.options.endpoints!.token_endpoint}`,\n      method: \"POST\",\n      requestType: \"form\",\n      body: mergedOptions as any,\n      headers: extraTokenHeaders,\n    })\n  }\n\n  /**\n   * Exchange refresh token with given options\n   * @param options\n   * @private\n   */\n  private async exchangeRefreshToken(options: Partial<TokenRequestOption>) {\n    if (!this.options.endpoints?.token_endpoint) {\n      await this.fetchFromIssuer()\n    }\n    const { extraTokenHeaders, extraTokenParams, ...rest } = options\n    const mergedOptions = {\n      grant_type: \"refresh_token\",\n      client_id: this.options.client_id,\n      client_secret: this.options.client_secret,\n      ...rest,\n      ...(extraTokenParams || {}),\n    }\n\n    for (const req of [\"refresh_token\", \"client_id\"] as const) {\n      if (!mergedOptions[req]) {\n        return Promise.reject(new Error(`\"${req}\" is required`))\n      }\n    }\n\n    return this.http({\n      url: `${this.options.endpoints!.token_endpoint}`,\n      method: \"POST\",\n      requestType: \"form\",\n      body: mergedOptions as any,\n      headers: extraTokenHeaders,\n    })\n  }\n\n  /**\n   * Fetch OIDC configuration from the issuer.\n   */\n  private async fetchFromIssuer(): Promise<Record<string, any>> {\n    try {\n      const requestUrl = `${this.options.issuer}/.well-known/openid-configuration`\n      const response = await this.http({\n        url: requestUrl,\n        method: \"GET\",\n        requestType: \"json\",\n      })\n      this.issuer_metadata = response as Record<string, any>\n      const endpoints = {} as any\n      for (const prop of Object.keys(this.issuer_metadata)) {\n        if (\n          prop.endsWith(\"_endpoint\") ||\n          prop.indexOf(\"_session\") > -1 ||\n          prop.indexOf(\"_uri\") > -1\n        ) {\n          endpoints[prop as keyof IEndpointConfiguration] = this.issuer_metadata[prop]\n        }\n      }\n      this.options.endpoints = endpoints\n      return this.issuer_metadata\n    } catch (e) {\n      throw new OIDCClientError(\"Loading metadata failed\", e.message)\n    }\n  }\n\n  /**\n   * Handle auth request result. If there is `code` exchange it.\n   * @param response\n   * @param finalOptions\n   * @param localState\n   * @private\n   */\n  private async handleAuthResponse(\n    response: any,\n    finalOptions: AuthRequestOptions,\n    localState: Record<string, any> = {},\n  ) {\n    if (response.code) {\n      return this.exchangeAuthorizationCode({\n        redirect_uri: finalOptions.redirect_uri,\n        client_id: finalOptions.client_id,\n        code_verifier: localState.code_verifier,\n        grant_type: \"authorization_code\",\n        code: response.code,\n      })\n    }\n    return response\n  }\n\n  /**\n   * Handle OAuth2 auth request result\n   * @param tokenResult\n   * @param authParams\n   * @param finalOptions\n   * @private\n   */\n  private async handleTokenResult(\n    tokenResult: TokenResponse,\n    authParams: AuthRequestOptions,\n    finalOptions: IPlusAuthClientOptions,\n  ) {\n    await this.initialize(false)\n    let user: any = {}\n    if (tokenResult.error) {\n      throw new AuthenticationError(tokenResult.error, tokenResult.error_description)\n    }\n    let parsedIDToken: any\n    if (tokenResult.id_token) {\n      parsedIDToken = await validateIdToken(tokenResult.id_token, authParams.nonce!, finalOptions)\n      if (\n        finalOptions.idTokenValidator &&\n        !(await finalOptions.idTokenValidator(tokenResult.id_token))\n      ) {\n        return Promise.reject(new InvalidIdTokenError(\"Id Token validation failed\"))\n      }\n      Object.keys(parsedIDToken).forEach((key) => {\n        if (!nonUserClaims.includes(key as any)) {\n          user[key] = parsedIDToken[key]\n        }\n      })\n    }\n\n    if (tokenResult.access_token) {\n      if (finalOptions.requestUserInfo && this.options.endpoints?.userinfo_endpoint) {\n        const userInfoResult = await this.fetchUserInfo(tokenResult.access_token)\n        if (!userInfoResult.error) {\n          user = { ...user, ...userInfoResult }\n        }\n      }\n    }\n\n    return {\n      authParams,\n      user,\n      ...tokenResult,\n      id_token: parsedIDToken,\n      id_token_raw: tokenResult.id_token,\n      scope: tokenResult.scope !== undefined ? tokenResult.scope : authParams.scope,\n    }\n  }\n\n  /**\n   * Load stored state\n   *\n   * @param state\n   * @private\n   */\n  private async loadState(state: string) {\n    const rawStoredState = await this.stateStore.get(state)\n    if (!rawStoredState) {\n      return Promise.reject(new StateNotFound(\"Local state not found\", state))\n    }\n    await this.stateStore.del(state)\n    return rawStoredState\n  }\n\n  /**\n   * Load user info by making request to providers `userinfo_endpoint`\n   *\n   * @param accessToken\n   * @private\n   */\n  private async fetchUserInfo(accessToken: string) {\n    return this.http({\n      method: \"GET\",\n      url: `${this.options.endpoints!.userinfo_endpoint}`,\n      requestType: \"json\",\n      headers: {\n        Authorization: `Bearer ${accessToken}`,\n      },\n    })\n  }\n\n  /**\n   * Start monitoring End-User's session if the OIDC provider supports session management. See more at [OIDC Session\n   * Management](https://openid.net/specs/openid-connect-session-1_0.html)\n   *\n   * @param sub End-User's id to for monitoring session\n   * @param session_state string that represents the End-User's login state at the OP\n   */\n  private monitorSession({ sub, session_state }: SessionMonitorOptions) {\n    const { client_id, endpoints } = this.options\n\n    if (!endpoints?.check_session_iframe) {\n      console.warn(\n        '\"check_session_iframe\" endpoint missing or session management is not supported by provider',\n      )\n      return\n    }\n    if (!this.sessionCheckerFrame) {\n      const sessionCheckCallback = async (err: any) => {\n        if (err) {\n          this.emit(Events.USER_LOGOUT)\n        } else {\n          this.emit(Events.SESSION_CHANGE)\n          try {\n            await this.silentLogin({}, {})\n            const storedAuth = await this.authStore.get(\"auth\")\n            if (storedAuth) {\n              if (storedAuth.user?.sub === sub && storedAuth.session_state) {\n                this.sessionCheckerFrame!.start(storedAuth.session_state)\n              }\n            } else {\n              this.emit(Events.USER_LOGOUT, null)\n            }\n          } catch (e) {\n            this.emit(Events.USER_LOGOUT)\n            return\n          }\n        }\n      }\n\n      this.sessionCheckerFrame = createSessionCheckerFrame({\n        url: endpoints.check_session_iframe,\n        client_id: client_id,\n        callback: sessionCheckCallback,\n        checkInterval: this.options.checkSessionInterval,\n      })\n    }\n\n    this.sessionCheckerFrame.start(session_state)\n  }\n\n  private async onUserLogin(authObj: any, isInternal = false) {\n    const {\n      expires_in,\n      user,\n      scope,\n      access_token,\n      id_token,\n      refresh_token,\n      session_state,\n      id_token_raw,\n    } = authObj\n    await this.authStore.set(\"auth\", authObj)\n\n    this.user = user\n    this.scopes = scope?.split(\" \").filter(Boolean)\n    this.accessToken = access_token\n    this.idToken = id_token\n    this.idTokenRaw = id_token_raw\n    this.refreshToken = refresh_token\n\n    if (!isInternal) {\n      this.emit(Events.USER_LOGIN, authObj)\n    }\n    if (!window?.frameElement) {\n      if (this.options.checkSession) {\n        this.monitorSession({ sub: user.sub || user.id, session_state })\n      }\n\n      if (expires_in !== undefined && this.options.autoSilentRenew) {\n        const expiration = Number(expires_in) - this.options.secondsToRefreshAccessTokenBeforeExp!\n        const renew = () => {\n          this.synchronizer.CallOnce(\"silent-login\", async () => {\n            try {\n              await this.silentLogin()\n              this.emit(Events.SILENT_RENEW_SUCCESS, null)\n            } catch (e) {\n              this.emit(Events.SILENT_RENEW_ERROR, e)\n            }\n          })\n        }\n        if (expiration >= 0) {\n          this._accessTokenExpireTimer!.start(expiration, async () => {\n            renew()\n          })\n        } else {\n          renew()\n        }\n      }\n    }\n  }\n}\n","'use strict'\n\nexports.byteLength = byteLength\nexports.toByteArray = toByteArray\nexports.fromByteArray = fromByteArray\n\nvar lookup = []\nvar revLookup = []\nvar Arr = typeof Uint8Array !== 'undefined' ? Uint8Array : Array\n\nvar code = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'\nfor (var i = 0, len = code.length; i < len; ++i) {\n  lookup[i] = code[i]\n  revLookup[code.charCodeAt(i)] = i\n}\n\n// Support decoding URL-safe base64 strings, as Node.js does.\n// See: https://en.wikipedia.org/wiki/Base64#URL_applications\nrevLookup['-'.charCodeAt(0)] = 62\nrevLookup['_'.charCodeAt(0)] = 63\n\nfunction getLens (b64) {\n  var len = b64.length\n\n  if (len % 4 > 0) {\n    throw new Error('Invalid string. Length must be a multiple of 4')\n  }\n\n  // Trim off extra bytes after placeholder bytes are found\n  // See: https://github.com/beatgammit/base64-js/issues/42\n  var validLen = b64.indexOf('=')\n  if (validLen === -1) validLen = len\n\n  var placeHoldersLen = validLen === len\n    ? 0\n    : 4 - (validLen % 4)\n\n  return [validLen, placeHoldersLen]\n}\n\n// base64 is 4/3 + up to two characters of the original data\nfunction byteLength (b64) {\n  var lens = getLens(b64)\n  var validLen = lens[0]\n  var placeHoldersLen = lens[1]\n  return ((validLen + placeHoldersLen) * 3 / 4) - placeHoldersLen\n}\n\nfunction _byteLength (b64, validLen, placeHoldersLen) {\n  return ((validLen + placeHoldersLen) * 3 / 4) - placeHoldersLen\n}\n\nfunction toByteArray (b64) {\n  var tmp\n  var lens = getLens(b64)\n  var validLen = lens[0]\n  var placeHoldersLen = lens[1]\n\n  var arr = new Arr(_byteLength(b64, validLen, placeHoldersLen))\n\n  var curByte = 0\n\n  // if there are placeholders, only get up to the last complete 4 chars\n  var len = placeHoldersLen > 0\n    ? validLen - 4\n    : validLen\n\n  var i\n  for (i = 0; i < len; i += 4) {\n    tmp =\n      (revLookup[b64.charCodeAt(i)] << 18) |\n      (revLookup[b64.charCodeAt(i + 1)] << 12) |\n      (revLookup[b64.charCodeAt(i + 2)] << 6) |\n      revLookup[b64.charCodeAt(i + 3)]\n    arr[curByte++] = (tmp >> 16) & 0xFF\n    arr[curByte++] = (tmp >> 8) & 0xFF\n    arr[curByte++] = tmp & 0xFF\n  }\n\n  if (placeHoldersLen === 2) {\n    tmp =\n      (revLookup[b64.charCodeAt(i)] << 2) |\n      (revLookup[b64.charCodeAt(i + 1)] >> 4)\n    arr[curByte++] = tmp & 0xFF\n  }\n\n  if (placeHoldersLen === 1) {\n    tmp =\n      (revLookup[b64.charCodeAt(i)] << 10) |\n      (revLookup[b64.charCodeAt(i + 1)] << 4) |\n      (revLookup[b64.charCodeAt(i + 2)] >> 2)\n    arr[curByte++] = (tmp >> 8) & 0xFF\n    arr[curByte++] = tmp & 0xFF\n  }\n\n  return arr\n}\n\nfunction tripletToBase64 (num) {\n  return lookup[num >> 18 & 0x3F] +\n    lookup[num >> 12 & 0x3F] +\n    lookup[num >> 6 & 0x3F] +\n    lookup[num & 0x3F]\n}\n\nfunction encodeChunk (uint8, start, end) {\n  var tmp\n  var output = []\n  for (var i = start; i < end; i += 3) {\n    tmp =\n      ((uint8[i] << 16) & 0xFF0000) +\n      ((uint8[i + 1] << 8) & 0xFF00) +\n      (uint8[i + 2] & 0xFF)\n    output.push(tripletToBase64(tmp))\n  }\n  return output.join('')\n}\n\nfunction fromByteArray (uint8) {\n  var tmp\n  var len = uint8.length\n  var extraBytes = len % 3 // if we have 1 byte left, pad 2 bytes\n  var parts = []\n  var maxChunkLength = 16383 // must be multiple of 3\n\n  // go through the array every three bytes, we'll deal with trailing stuff later\n  for (var i = 0, len2 = len - extraBytes; i < len2; i += maxChunkLength) {\n    parts.push(encodeChunk(uint8, i, (i + maxChunkLength) > len2 ? len2 : (i + maxChunkLength)))\n  }\n\n  // pad the end with zeros, but make sure to not forget the extra bytes\n  if (extraBytes === 1) {\n    tmp = uint8[len - 1]\n    parts.push(\n      lookup[tmp >> 2] +\n      lookup[(tmp << 4) & 0x3F] +\n      '=='\n    )\n  } else if (extraBytes === 2) {\n    tmp = (uint8[len - 2] << 8) + uint8[len - 1]\n    parts.push(\n      lookup[tmp >> 10] +\n      lookup[(tmp >> 4) & 0x3F] +\n      lookup[(tmp << 2) & 0x3F] +\n      '='\n    )\n  }\n\n  return parts.join('')\n}\n","import { fromByteArray } from \"base64-js\"\n\nexport function isValidIssuer(issuer: string) {\n  try {\n    const url = new URL(issuer)\n    if (![\"http:\", \"https:\"].includes(url.protocol)) {\n      return false\n    }\n    if (url.search !== \"\" || url.hash !== \"\") {\n      return false\n    }\n    return true\n  } catch (e) {\n    return false\n  }\n}\nexport function buildEncodedQueryString(obj?: Record<string, any>, appendable = true) {\n  if (!obj) return \"\"\n  const ret: string[] = []\n  for (const d in obj) {\n    if (obj.hasOwnProperty(d) && obj[d]) {\n      ret.push(\n        `${encodeURIComponent(d)}=${encodeURIComponent(\n          typeof obj[d] === \"object\" ? JSON.stringify(obj[d]) : obj[d]!,\n        )}`,\n      )\n    }\n  }\n  return `${appendable ? \"?\" : \"\"}${ret.join(\"&\")}`\n}\n\nexport function parseQueryUrl(value: string) {\n  const result: Record<string, string> = {}\n  value = value.trim().replace(/^(\\?|#|&)/, \"\")\n  const params = value.split(\"&\")\n  for (let i = 0; i < params.length; i += 1) {\n    const paramAndValue = params[i]\n    const parts = paramAndValue.split(\"=\")\n    const key = decodeURIComponent(parts.shift()!)\n    const value = parts.length > 0 ? parts.join(\"=\") : \"\"\n    result[key] = decodeURIComponent(value)\n  }\n  return result\n}\n\nexport function urlSafe(data: Uint8Array | string): string {\n  const encoded = typeof data === \"string\" ? data : fromByteArray(new Uint8Array(data))\n  return encoded.replace(/\\+/g, \"-\").replace(/\\//g, \"_\").replace(/=/g, \"\")\n}\n","import { buildEncodedQueryString } from \"./url\"\n\nexport interface RequestOptions {\n  body?: Record<string, string | number | null | undefined>\n  headers?: Record<string, string>\n  method: \"GET\" | \"POST\" | \"PATCH\" | \"TRACE\" | \"OPTIONS\" | \"HEAD\"\n  requestType?: \"form\" | \"json\"\n  url: string\n}\n\nexport function request(options: RequestOptions): Promise<any> {\n  let body: any = null\n  let headers = options.headers || {}\n  if (options.method === \"POST\") {\n    headers = {\n      \"Content-Type\":\n        options.requestType === \"form\"\n          ? \"application/x-www-form-urlencoded;charset=UTF-8\"\n          : \"application/json;charset=UTF-8\",\n      ...headers,\n    }\n  }\n  if (options.body) {\n    body =\n      options.requestType === \"form\"\n        ? buildEncodedQueryString(options.body, false)\n        : JSON.stringify(options.body)\n  }\n\n  return new Promise((resolve, reject) => {\n    fetch(options.url, {\n      method: options.method,\n      body: body,\n      headers,\n    })\n      .then((value: Response) => resolve(value.json()))\n      .catch(reject)\n  })\n}\n","import { urlSafe } from \"./url\"\n\nexport async function sha256(str: string) {\n  if (typeof window.crypto !== \"undefined\" && \"subtle\" in window.crypto) {\n    const buffer = await window.crypto.subtle.digest(\"SHA-256\", new TextEncoder().encode(str))\n    return urlSafe(new Uint8Array(buffer))\n  }\n  return urlSafe(_sha256(str)!)\n}\n\n/**\n * Generate sha-256 hash of a string.\n *\n * @link https://geraintluff.github.io/sha256/\n *\n * @param data data to generate hash of\n * @param base64 By default the returned value is base64 encoded. If `false` format will be hex.\n */\nfunction _sha256(data: string, base64 = true) {\n  function rightRotate(value: number, amount: number) {\n    return (value >>> amount) | (value << (32 - amount))\n  }\n\n  const mathPow = Math.pow\n  const maxWord = mathPow(2, 32)\n  const lengthProperty = \"length\"\n  let i\n  let j\n  let result = \"\"\n\n  const words = [] as number[]\n  const asciiBitLength = data[lengthProperty] * 8\n\n  // @ts-ignore\n  let hash = (sha256.h = sha256.h || [])\n  // @ts-ignore\n  const k = (sha256.k = sha256.k || [])\n  let primeCounter = k[lengthProperty]\n  const isComposite = {} as Record<number, number>\n  for (let candidate = 2; primeCounter < 64; candidate++) {\n    if (!isComposite[candidate]) {\n      for (i = 0; i < 313; i += candidate) {\n        isComposite[i] = candidate\n      }\n      hash[primeCounter] = (mathPow(candidate, 0.5) * maxWord) | 0\n      k[primeCounter++] = (mathPow(candidate, 1 / 3) * maxWord) | 0\n    }\n  }\n  data += \"\\x80\" // Append ?' bit (plus zero padding)\n  while ((data[lengthProperty] % 64) - 56) data += \"\\x00\" // More zero padding\n  for (i = 0; i < data[lengthProperty]; i++) {\n    j = data.charCodeAt(i)\n    if (j >> 8) return // ASCII check: only accept characters in range 0-255\n    words[i >> 2] |= j << (((3 - i) % 4) * 8)\n  }\n  words[words[lengthProperty]] = (asciiBitLength / maxWord) | 0\n  words[words[lengthProperty]] = asciiBitLength\n\n  for (j = 0; j < words[lengthProperty]; ) {\n    const w = words.slice(j, (j += 16))\n    const oldHash = hash\n    hash = hash.slice(0, 8)\n\n    for (i = 0; i < 64; i++) {\n      const w15 = w[i - 15]\n      const w2 = w[i - 2]\n      const a = hash[0]\n      const e = hash[4]\n      const temp1 =\n        hash[7] +\n        (rightRotate(e, 6) ^ rightRotate(e, 11) ^ rightRotate(e, 25)) + // S1\n        ((e & hash[5]) ^ (~e & hash[6])) + // ch\n        k[i] +\n        (w[i] =\n          i < 16\n            ? w[i]\n            : (w[i - 16] +\n                (rightRotate(w15, 7) ^ rightRotate(w15, 18) ^ (w15 >>> 3)) + // s0\n                w[i - 7] +\n                (rightRotate(w2, 17) ^ rightRotate(w2, 19) ^ (w2 >>> 10))) | // s1\n              0)\n      const temp2 =\n        (rightRotate(a, 2) ^ rightRotate(a, 13) ^ rightRotate(a, 22)) + // S0\n        ((a & hash[1]) ^ (a & hash[2]) ^ (hash[1] & hash[2])) // maj\n\n      hash = [(temp1 + temp2) | 0].concat(hash)\n      hash[4] = (hash[4] + temp1) | 0\n    }\n\n    for (i = 0; i < 8; i++) {\n      hash[i] = (hash[i] + oldHash[i]) | 0\n    }\n  }\n\n  for (i = 0; i < 8; i++) {\n    for (j = 3; j + 1; j--) {\n      const b = (hash[i] >> (j * 8)) & 255\n      result += (b < 16 ? 0 : \"\") + b.toString(16)\n    }\n  }\n  return base64\n    ? btoa(\n        result\n          .match(/\\w{2}/g)!\n          .map((a) => String.fromCharCode(Number.parseInt(a, 16)))\n          .join(\"\"),\n      )\n    : result\n}\n","import { InvalidIdTokenError, InvalidJWTError, OIDCClientError } from \"../errors\"\nimport type { IPlusAuthClientOptions, JWTValidationOptions, ParsedJWT } from \"../interfaces\"\nimport { sha256 } from \"./crypto\"\n\nconst CHARSET = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\"\n\nfunction getRandomBytes(n: number) {\n  // @ts-ignore\n  const crypto = self.crypto || self.msCrypto\n  const QUOTA = 65536\n  const a = new Uint8Array(n)\n  for (let i = 0; i < n; i += QUOTA) {\n    crypto.getRandomValues(a.subarray(i, i + Math.min(n - i, QUOTA)))\n  }\n  return a\n}\n\nexport function generateRandom(length: number) {\n  let out = \"\"\n  const charsLen = CHARSET.length\n  const maxByte = 256 - (256 % charsLen)\n  while (length > 0) {\n    const buf = getRandomBytes(Math.ceil((length * 256) / maxByte))\n    for (let i = 0; i < buf.length && length > 0; i++) {\n      const randomByte = buf[i]\n      if (randomByte < maxByte) {\n        out += CHARSET.charAt(randomByte % charsLen)\n        length--\n      }\n    }\n  }\n  return out\n}\n\nexport async function deriveChallenge(code: string): Promise<string> {\n  if (code.length < 43 || code.length > 128) {\n    return Promise.reject(new OIDCClientError(`Invalid code length: ${code.length}`))\n  }\n  return await sha256(code)\n}\n// https://datatracker.ietf.org/doc/html/rfc4648#section-5\nexport const urlDecodeB64 = (input: string) =>\n  decodeURIComponent(\n    atob(input.replace(/_/g, \"/\").replace(/-/g, \"+\"))\n      .split(\"\")\n      .map((c) => {\n        return `%${`00${c.charCodeAt(0).toString(16)}`.slice(-2)}`\n      })\n      .join(\"\"),\n  )\n\nexport function parseJwt(jwt: string): ParsedJWT {\n  try {\n    const parts = jwt.split(\".\")\n    if (parts.length !== 3) {\n      throw new Error(\"Wrong JWT format\")\n    }\n    return {\n      header: JSON.parse(urlDecodeB64(parts[0])),\n      payload: JSON.parse(urlDecodeB64(parts[1])),\n    }\n  } catch (e) {\n    throw new InvalidJWTError(\"Failed to parse jwt\")\n  }\n}\n\nexport function validateIdToken(id_token: string, nonce: string, options: IPlusAuthClientOptions) {\n  if (!nonce) {\n    throw new OIDCClientError(\"No nonce on state\")\n  }\n\n  try {\n    const jwt = parseJwt(id_token)\n\n    if (nonce !== jwt.payload.nonce) {\n      throw new Error(`Invalid nonce in id_token: ${jwt.payload.nonce}`)\n    }\n\n    validateJwt(id_token, options, true)\n\n    // @ts-ignore\n    if (!jwt.payload[\"sub\"]) {\n      throw new Error(\"No Subject (sub) present in id_token\")\n    }\n\n    return jwt.payload\n  } catch (e) {\n    throw new InvalidIdTokenError(e.message)\n  }\n}\n\nexport function validateJwt(jwt: string, options: JWTValidationOptions, isIdToken = false) {\n  // eslint-disable-next-line prefer-const\n  let { clockSkew, currentTimeInMillis, issuer, audience, client_id } = options\n  if (!clockSkew) {\n    clockSkew = 0\n  }\n  const now = (currentTimeInMillis?.() || Date.now()) / 1000\n\n  const payload = parseJwt(jwt).payload\n\n  if (!payload.iss) {\n    throw new InvalidJWTError(\"Issuer (iss) was not provided\")\n  }\n  if (payload.iss !== issuer) {\n    throw new InvalidJWTError(`Invalid Issuer (iss) in token: ${payload.iss}`)\n  }\n\n  if (!payload.aud) {\n    throw new InvalidJWTError(\"Audience (aud) was not provided\")\n  }\n\n  // Audience must be equal to client_id in id_token\n  // https://openid.net/specs/openid-connect-core-1_0.html#IDToken\n  if (\n    Array.isArray(payload.aud)\n      ? payload.aud.indexOf(isIdToken ? client_id : audience || client_id) === -1\n      : payload.aud !== (isIdToken ? client_id : audience || client_id)\n  ) {\n    throw new InvalidJWTError(`Invalid Audience (aud) in token: ${payload.aud}`)\n  }\n\n  if (payload.azp && payload.azp !== client_id) {\n    throw new InvalidJWTError(`Invalid Authorized Party (azp) in token: ${payload.azp}`)\n  }\n\n  const lowerNow = Math.ceil(now + clockSkew)\n  const upperNow = Math.floor(now - clockSkew)\n\n  if (!payload.iat) {\n    throw new InvalidJWTError(\"Issued At (iat) was not provided\")\n  }\n\n  if (lowerNow < Number(payload.iat)) {\n    throw new InvalidJWTError(`Issued At (iat) is in the future: ${payload.iat}`)\n  }\n\n  if (payload.nbf && lowerNow < Number(payload.nbf)) {\n    throw new InvalidJWTError(`Not Before time (nbf) is in the future: ${payload.nbf}`)\n  }\n\n  if (!payload.exp) {\n    throw new InvalidJWTError(\"Expiration Time (exp) was not provided\")\n  }\n  if (Number(payload.exp) < upperNow) {\n    throw new InvalidJWTError(`Expiration Time (exp) is in the past: ${payload.exp}`)\n  }\n\n  return payload\n}\n\n// Retrieved from https://www.iana.org/assignments/jwt/jwt.xhtml\nexport const nonUserClaims = [\n  \"iss\",\n  // 'sub',\n  \"aud\",\n  \"exp\",\n  \"nbf\",\n  \"iat\",\n  \"jti\",\n  \"azp\",\n  \"nonce\",\n  \"auth_time\",\n  \"at_hash\",\n  \"c_hash\",\n  \"acr\",\n  \"amr\",\n  \"sub_jwk\",\n  \"cnf\",\n  \"sip_from_tag\",\n  \"sip_date\",\n  \"sip_callid\",\n  \"sip_cseq_num\",\n  \"sip_via_branch\",\n  \"orig\",\n  \"dest\",\n  \"mky\",\n  \"events\",\n  \"toe\",\n  \"txn\",\n  \"rph\",\n  \"sid\",\n  \"vot\",\n  \"vtm\",\n  \"attest\",\n  \"origid\",\n  \"act\",\n  \"scope\",\n  \"client_id\",\n  \"may_act\",\n  \"jcard\",\n  \"at_use_nbr\",\n] as const\n","type RequiredAndNotNull<T> = {\n  [P in keyof T]-?: Exclude<T[P], undefined>\n}\n\n/**\n * not suitable for every object but it is enough for this library\n * @param object\n */\nexport function cleanUndefined<T extends Record<string, any>>(object: T) {\n  if (!object || typeof object !== \"object\") {\n    return object\n  }\n  return JSON.parse(JSON.stringify(object)) as RequiredAndNotNull<T>\n}\n\nfunction merge(previousValue: any, currentValue: any) {\n  for (const p in currentValue) {\n    if (currentValue[p] !== undefined) {\n      if (typeof currentValue[p] === \"object\" && currentValue[p].constructor.name === \"Object\") {\n        previousValue[p] = merge(previousValue[p] || {}, currentValue[p])\n      } else {\n        previousValue[p] = currentValue[p]\n      }\n    }\n  }\n  return previousValue\n}\nexport function mergeObjects<T extends object, U>(obj1: T, obj2: U): RequiredAndNotNull<T & U>\nexport function mergeObjects<T extends object, U, K>(\n  obj1: T,\n  obj2: U,\n  obj3: K,\n): RequiredAndNotNull<T & U & K>\nexport function mergeObjects(...objects: any[]) {\n  return objects.reduce((previousValue, currentValue) => {\n    return merge(previousValue || {}, currentValue)\n  }, {}) as any\n}\n","export const isResponseType = (type: string, response_type?: string) =>\n  response_type && response_type.split(/\\s+/g).filter((rt) => rt === type).length > 0\n\nexport const isScopeIncluded = (scope: string, scopes?: string) =>\n  scopes && scopes.split(\" \").indexOf(scope) > -1\n","import { InteractionCancelled, OIDCClientError } from \"../errors\"\nimport type { PopupOptions } from \"../interfaces\"\n\nconst openPopup = (url: string, width = 400, height = 600) => {\n  const left = window.screenX + (window.innerWidth - width) / 2\n  const top = window.screenY + (window.innerHeight - height) / 2\n\n  return window.open(\n    url,\n    \"oidc-login-popup\",\n    `left=${left},top=${top},width=${width},height=${height},resizable,scrollbars=yes,status=1`,\n  )\n}\n\nexport function runPopup(url: string, options: PopupOptions) {\n  let popup = options.popup\n\n  if (popup) {\n    popup.location.href = url\n  } else {\n    popup = openPopup(url)\n  }\n\n  if (!popup) {\n    /* istanbul ignore next */\n    throw new Error(\"Could not open popup\")\n  }\n\n  let timeoutId: any\n  let closeId: any\n\n  return new Promise<{ response: any; state: string }>((resolve, reject) => {\n    function clearHandlers() {\n      clearInterval(closeId)\n      clearTimeout(timeoutId)\n      window.removeEventListener(\"message\", messageListener)\n    }\n\n    timeoutId = setTimeout(\n      () => {\n        clearHandlers()\n        reject(new OIDCClientError(\"Timed out\"))\n      },\n      options.timeout || 60 * 1000,\n    )\n\n    closeId = setInterval(() => {\n      if (popup!.closed) {\n        clearHandlers()\n        reject(new InteractionCancelled(\"user closed popup\"))\n      }\n    }, 300)\n\n    window.addEventListener(\"message\", messageListener)\n\n    function messageListener(e: MessageEvent) {\n      if (!e.data || e.data.type !== \"authorization_response\") return\n      clearHandlers()\n      popup!.close()\n      const data = e.data.response || e.data\n      data.error ? reject(new OIDCClientError(data.error, data.error_description)) : resolve(e.data)\n    }\n  })\n}\n","/*\nJitbit TabUtils - helper for multiple browser tabs. version 1.0\nhttps://github.com/jitbit/TabUtils\n- executing \"interlocked\" function call - only once per multiple tabs\n- broadcasting a message to all tabs (including the current one) with some message \"data\"\n- handling a broadcasted message\nMIT license: https://github.com/jitbit/TabUtils/blob/master/LICENSE\n*/\n\nimport type { EventEmitter } from \"../helpers\"\n\nconst currentTabId = `${performance.now()}:${(Math.random() * 1000000000) | 0}`\nconst handlers: Record<string, any> = {}\n\nexport class TabUtils {\n  keyPrefix: string\n\n  private events: EventEmitter<any>\n\n  constructor(kid: string, fallbackEvents: EventEmitter<any>) {\n    this.keyPrefix = kid\n    this.events = fallbackEvents\n  }\n\n  //runs code only once in multiple tabs\n  //the lock holds for 4 seconds (in case the function is async and returns right away, for example, an ajax call intiated)\n  //then it is cleared\n  CallOnce(lockname: string, fn: () => void, timeout = 3000): void {\n    if (!lockname) throw \"empty lockname\"\n\n    if (!window.localStorage) {\n      //no local storage. old browser. screw it, just run the function\n      fn()\n      return\n    }\n\n    const localStorageKey = this.keyPrefix + lockname\n\n    localStorage.setItem(localStorageKey, currentTabId)\n    //re-read after a delay (after all tabs have saved their tabIDs into ls)\n    setTimeout(() => {\n      if (localStorage.getItem(localStorageKey) === currentTabId) fn()\n    }, 150)\n\n    //cleanup - release the lock after 3 seconds and on window unload (just in case user closed the window while the lock is still held)\n    setTimeout(() => {\n      localStorage.removeItem(localStorageKey)\n    }, timeout)\n  }\n\n  BroadcastMessageToAllTabs(messageId: string, eventData: any): void {\n    //now we also need to manually execute handler in the current tab too, because current tab does not get 'storage' events\n    try {\n      handlers[messageId](eventData)\n    } catch (x) {\n      //\"try\" in case handler not found\n    }\n\n    if (!window.localStorage) {\n      this.events.emit(messageId, eventData)\n      return //no local storage. old browser\n    }\n\n    const data = {\n      data: eventData,\n      timeStamp: new Date().getTime(),\n    } //add timestamp because overwriting same data does not trigger the event\n\n    //this triggers 'storage' event for all other tabs except the current tab\n    localStorage.setItem(`${this.keyPrefix}event${messageId}`, JSON.stringify(data))\n\n    //cleanup\n    setTimeout(() => {\n      localStorage.removeItem(`${this.keyPrefix}event${messageId}`)\n    }, 3000)\n  }\n\n  OnBroadcastMessage(messageId: string, fn: (data: any) => void): void {\n    handlers[messageId] = fn\n    if (!window.localStorage) {\n      this.events.on(messageId, fn)\n      return //no local storage. old browser\n    }\n\n    //first register a handler for \"storage\" event that we trigger above\n    window.addEventListener(\"storage\", (ev) => {\n      if (ev.key !== `${this.keyPrefix}event${messageId}`) return // ignore other keys\n      if (!ev.newValue) return //called by cleanup?\n      const messageData = JSON.parse(ev.newValue)\n      fn(messageData.data)\n    })\n  }\n}\n","import type { SessionChecker, SessionCheckerOptions } from \"../interfaces\"\n\nimport { createHiddenFrame } from \"./iframe\"\n\nconst DEFAULT_CHECK_INTERVAL = 2000\n\nexport function createSessionCheckerFrame(options: SessionCheckerOptions): SessionChecker {\n  const { url, callback, client_id, checkInterval } = options\n  let internalSessionState: string | null\n  const idx = url.indexOf(\"/\", url.indexOf(\"//\") + 2)\n  const frameOrigin = url.substr(0, idx)\n\n  const frame = createHiddenFrame()\n\n  let timer: any\n\n  const load = () => {\n    return new Promise((resolve) => {\n      window.document.body.appendChild(frame)\n      window.addEventListener(\"message\", iframeEventHandler, false)\n      frame.onload = () => {\n        resolve(null)\n      }\n    })\n  }\n\n  const start = (sessionState: string) => {\n    load().then(() => {\n      if (sessionState && internalSessionState !== sessionState) {\n        stop()\n        internalSessionState = sessionState\n        const send = () => {\n          frame.contentWindow!.postMessage(`${client_id} ${internalSessionState}`, frameOrigin)\n        }\n        send()\n        timer = window.setInterval(send, checkInterval || DEFAULT_CHECK_INTERVAL)\n      }\n    })\n  }\n\n  const stop = () => {\n    internalSessionState = null\n    if (timer) {\n      window.clearInterval(timer)\n      timer = null\n    }\n  }\n\n  const iframeEventHandler = (e: MessageEvent) => {\n    if (e.origin === frameOrigin && e.source === frame.contentWindow) {\n      if (e.data === \"error\") {\n        stop()\n        callback(e.data)\n      } else if (e.data === \"changed\") {\n        stop()\n        callback()\n      }\n    }\n  }\n\n  frame.setAttribute(\"src\", url)\n\n  return {\n    stop,\n    start,\n  }\n}\n","import { OIDCClient } from \"./client\"\nimport type { IPlusAuthClientOptions } from \"./interfaces\"\n\nexport * from \"./interfaces\"\nexport * from \"./client\"\nexport * from \"./constants\"\nexport * from \"./helpers\"\nexport * from \"./errors\"\n\n/**\n * Create OIDC client with initializing it. It resolves issuer metadata, jwks keys and check if user is\n * authenticated in OpenId Connect provider.\n */\nexport default function createOIDCClient(options: IPlusAuthClientOptions): Promise<OIDCClient> {\n  return new OIDCClient(options).initialize()\n}\n"],"names":["Events","USER_LOGOUT","USER_LOGIN","SILENT_RENEW_SUCCESS","SILENT_RENEW_ERROR","SESSION_CHANGE","OIDCClientError","Error","constructor","error","error_description","name","AuthenticationError","state","error_uri","StateNotFound","InvalidJWTError","details","InvalidIdTokenError","InteractionCancelled","StateStore","prefix","LocalStorageStateStore","get","key","Promise","resolve","value","window","localStorage","getItem","JSON","parse","set","setItem","stringify","del","removeItem","clear","before","i","storedKeys","length","substring","push","storedItem","created_at","e","InMemoryStateStore","map","forEach","val","ind","delete","Map","EventEmitter","once","event","fn","on","onArgs","off","apply","cb","callbacks","splice","emit","args","cbs","slice","len","Timer","start","duration","callback","expiration","now","_expiration","_timerHandle","stop","timerDuration","setInterval","clearInterval","currentTimeInMillisFunc","Date","_define_property","createHiddenFrame","iframe","document","createElement","style","width","height","position","visibility","display","title","ariaHidden","base64Js","byteLength","b64","lens","getLens","validLen","placeHoldersLen","toByteArray","tmp","arr","Arr","curByte","revLookup","charCodeAt","fromByteArray","uint8","extraBytes","parts","len2","encodeChunk","end","output","lookup","num","join","Uint8Array","Array","code","indexOf","buildEncodedQueryString","obj","appendable","ret","d","hasOwnProperty","encodeURIComponent","urlSafe","data","encoded","replace","request","options","body","headers","method","requestType","reject","fetch","url","then","json","catch","sha256","str","crypto","subtle","digest","TextEncoder","encode","_sha256","base64","j","rightRotate","amount","mathPow","Math","pow","maxWord","lengthProperty","result","words","asciiBitLength","hash","h","k","primeCounter","isComposite","candidate","w","oldHash","w15","w2","a","temp1","concat","b","toString","btoa","match","String","fromCharCode","Number","parseInt","CHARSET","generateRandom","out","charsLen","maxByte","buf","getRandomBytes","n","self","msCrypto","getRandomValues","subarray","min","ceil","randomByte","charAt","deriveChallenge","urlDecodeB64","input","decodeURIComponent","atob","split","c","parseJwt","jwt","header","payload","nonUserClaims","mergeObjects","objects","reduce","previousValue","currentValue","merge","p","undefined","isResponseType","type","response_type","filter","rt","isScopeIncluded","scope","scopes","openPopup","left","screenX","innerWidth","top","screenY","innerHeight","open","currentTabId","performance","random","handlers","TabUtils","CallOnce","lockname","timeout","localStorageKey","keyPrefix","setTimeout","BroadcastMessageToAllTabs","messageId","eventData","x","events","timeStamp","getTime","OnBroadcastMessage","addEventListener","ev","newValue","messageData","kid","fallbackEvents","OIDCClient","initialize","checkLogin","initialized","__initializePromise","stateStore","init","authStore","endpoints","Object","keys","fetchFromIssuer","frameElement","silentLogin","localAuth","onUserLogin","message","login","localState","location","assign","createAuthRequest","loginWithPopup","popupOptions","response_mode","request_type","response","runPopup","timeoutId","closeId","popup","href","clearHandlers","clearTimeout","removeEventListener","messageListener","close","closed","authParams","loadState","tokenResult","handleAuthResponse","authObject","handleTokenResult","session_state","synchronizer","loginCallback","parsedUrl","URL","responseParams","parseQueryUrl","params","trim","paramAndValue","shift","search","rawStoredState","parent","postMessage","protocol","host","opener","logout","localOnly","storedAuth","id_token_hint","id_token_raw","createLogoutRequest","revokeToken","token","revocation_endpoint","finalOptions","client_id","client_secret","token_type_hint","http","finalState","prompt","silent_redirect_uri","redirect_uri","useRefreshToken","refresh_token","exchangeRefreshToken","authUrl","silentRequestTimeout","eventOrigin","origin","onLoadTimeoutId","timeoutSetTimeoutId","removeIframe","iframeEventHandler","eventSource","source","resp","contains","removeChild","onLoadTimeout","appendChild","setAttribute","onload","getAccessToken","_this","access_token","getRefreshToken","getIdToken","id_token","getExpiresIn","expires_in","getIdTokenRaw","getScopes","_scope","Boolean","getUser","user","isLoggedIn","existsOnLocal","_this_options_endpoints","_this_options_currentTimeInMillis","_this_options","object","authorization_endpoint","code_verifier","stateLength","audience","ui_locales","claims","claims_locales","acr_values","nonce","registration","login_hint","web_message_uri","web_message_target","extraParams","nonceLength","code_challenge","code_challenge_method","currentTimeInMillis","call","fragment","authParamsString","end_session_endpoint","logoutParams","post_logout_redirect_uri","extraLogoutParams","exchangeAuthorizationCode","token_endpoint","extraTokenHeaders","extraTokenParams","rest","mergedOptions","grant_type","req","requestUrl","issuer","issuer_metadata","prop","endsWith","parsedIDToken","validateIdToken","validateJwt","isIdToken","clockSkew","iss","aud","isArray","azp","lowerNow","upperNow","floor","iat","nbf","exp","idTokenValidator","includes","requestUserInfo","userinfo_endpoint","userInfoResult","fetchUserInfo","accessToken","Authorization","monitorSession","sub","check_session_iframe","console","warn","sessionCheckerFrame","sessionCheckCallback","err","createSessionCheckerFrame","internalSessionState","timer","checkInterval","idx","frameOrigin","substr","frame","load","contentWindow","sessionState","send","checkSessionInterval","authObj","isInternal","idToken","idTokenRaw","refreshToken","checkSession","id","autoSilentRenew","secondsToRefreshAccessTokenBeforeExp","renew","_accessTokenExpireTimer","isValidIssuer","httpClient","bind"],"mappings":"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","x_google_ignoreList":[9]}